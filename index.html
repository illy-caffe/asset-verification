<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loaned Equipment Verification - illycaff√®</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fafafa 0%, #f0f0f0 100%);
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        
        .container {
            max-width: 950px;
            margin: 0 auto;
            background-color: white;
            padding: 50px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
            }
        }
        
        .logo-container {
            text-align: center;
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .logo-container img {
            max-width: 220px;
            height: auto;
        }
        
        h1 {
            color: #c8102e;
            text-align: center;
            margin-bottom: 15px;
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            font-size: 15px;
            margin-bottom: 35px;
            font-weight: 400;
        }
        
        h2 {
            color: #2c2c2c;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 22px;
            font-weight: 600;
            padding-bottom: 12px;
            border-bottom: 2px solid #c8102e;
            position: relative;
        }
        
        h2::before {
            content: '';
            position: absolute;
            left: 0;
            bottom: -2px;
            width: 60px;
            height: 2px;
            background: #c8102e;
            box-shadow: 0 0 8px rgba(200, 16, 46, 0.4);
        }
        
        h3 {
            color: #444;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 17px;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c2c2c;
            font-size: 14px;
        }
        
        .required::after {
            content: "*";
            color: #c8102e;
            margin-left: 4px;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px 14px;
            border: 1.5px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s ease;
            background-color: #fafafa;
        }
        
        input:hover,
        select:hover,
        textarea:hover {
            border-color: #c8c8c8;
            background-color: white;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #c8102e;
            background-color: white;
            box-shadow: 0 0 0 3px rgba(200, 16, 46, 0.08);
        }
        
        input.invalid {
            border-color: #c8102e;
            background-color: #fff5f5;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .radio-group {
            display: flex;
            gap: 24px;
            margin: 12px 0;
        }
        
        .radio-group label {
            display: flex;
            align-items: center;
            font-weight: 400;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }
        
        .radio-group label:hover {
            background-color: #f5f5f5;
        }
        
        .radio-group input[type="radio"] {
            margin-right: 8px;
            cursor: pointer;
            width: 18px;
            height: 18px;
            accent-color: #c8102e;
        }
        
        .asset-card {
            background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%);
            border: 1.5px solid #e8e8e8;
            border-radius: 10px;
            padding: 24px;
            margin-bottom: 24px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .asset-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #c8102e 0%, #a00d24 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .asset-card:hover {
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            transform: translateY(-2px);
            border-color: #c8102e;
        }
        
        .asset-card:hover::before {
            opacity: 1;
        }
        
        .asset-header {
            font-weight: 600;
            color: #c8102e;
            margin-bottom: 16px;
            font-size: 17px;
            letter-spacing: -0.2px;
        }
        
        .asset-info {
            margin-bottom: 16px;
            font-size: 14px;
            line-height: 1.8;
        }
        
        .asset-info strong {
            color: #444;
            font-weight: 600;
        }
        
        .sticker-field {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed #ddd;
            display: none;
        }
        
        .sticker-field.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        button {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 13px 26px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            margin-top: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }
        
        button:hover {
            background: linear-gradient(135deg, #45a049 0%, #3d8b40 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .add-machine-btn {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
            margin-top: 15px;
        }
        
        .add-machine-btn:hover {
            background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #c8102e 0%, #a00d24 100%);
            font-size: 18px;
            padding: 16px 48px;
            display: block;
            margin: 40px auto;
            font-weight: 600;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(200, 16, 46, 0.3);
        }
        
        .submit-btn:hover {
            background: linear-gradient(135deg, #a00d24 0%, #8a0b1f 100%);
            box-shadow: 0 6px 16px rgba(200, 16, 46, 0.4);
        }
        
        .intro-text {
            background: linear-gradient(135deg, #f0f8ff 0%, #e3f2fd 100%);
            padding: 24px;
            border-left: 4px solid #2196F3;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);
        }
        
        .thank-you {
            background: linear-gradient(135deg, #e8f5e9 0%, #dcedc8 100%);
            padding: 24px;
            border-left: 4px solid #4CAF50;
            margin-top: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.1);
        }
        
        .additional-machine {
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            border: 2px dashed #ffa726;
            border-radius: 10px;
            padding: 24px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(255, 167, 38, 0.1);
        }
        
        .remove-machine-btn {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            padding: 10px 18px;
            font-size: 14px;
            margin-top: 10px;
            box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);
        }
        
        .remove-machine-btn:hover {
            background: linear-gradient(135deg, #d32f2f 0%, #c62828 100%);
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.4);
        }
        
        .conditional-field {
            display: none;
            margin-top: 10px;
        }
        
        .conditional-field.show {
            display: block;
        }
        
        .error {
            color: #c8102e;
            font-size: 13px;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .error.show {
            display: block;
        }
        
        .validation-error {
            color: #c8102e;
            font-size: 13px;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .validation-error.show {
            display: block;
        }
        
        .account-search {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            padding: 28px;
            border-radius: 10px;
            margin-bottom: 35px;
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.1);
            border: 1.5px solid #ffe0b2;
        }
        
        #accountNumberInput {
            max-width: 320px;
        }
        
        .search-btn {
            background: linear-gradient(135deg, #c8102e 0%, #a00d24 100%);
            margin-left: 12px;
            box-shadow: 0 2px 8px rgba(200, 16, 46, 0.3);
        }
        
        .search-btn:hover {
            background: linear-gradient(135deg, #a00d24 0%, #8a0b1f 100%);
            box-shadow: 0 4px 12px rgba(200, 16, 46, 0.4);
        }
        
        #formContent {
            display: none;
        }
        
        .note {
            font-size: 13px;
            color: #666;
            font-style: italic;
            margin-top: 8px;
        }
        
        .success-message {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border: 2px solid #4CAF50;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            display: none;
            margin-top: 20px;
            box-shadow: 0 4px 16px rgba(76, 175, 80, 0.2);
        }
        
        .success-message h2 {
            color: #4CAF50;
            border: none;
            margin-bottom: 20px;
        }
        
        .success-message h2::before {
            display: none;
        }
        
        @keyframes checkmark {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .success-checkmark {
            width: 90px;
            height: 90px;
            margin: 0 auto 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: checkmark 0.6s ease;
            box-shadow: 0 4px 16px rgba(76, 175, 80, 0.3);
        }
        
        .success-checkmark::after {
            content: '‚úì';
            color: white;
            font-size: 54px;
            font-weight: bold;
        }
        
        .error-message {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border: 2px solid #f44336;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            display: none;
            margin-top: 20px;
            box-shadow: 0 4px 16px rgba(244, 67, 54, 0.2);
        }
        
        .error-message h2 {
            color: #f44336;
            border: none;
            margin-bottom: 20px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #666;
            font-weight: 500;
        }
        
        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        .sticker-hint {
            font-size: 12px;
            color: #666;
            margin-top: 6px;
            font-style: italic;
        }
        
        .customer-banner {
            text-align: center;
            background: linear-gradient(135deg, #f5f5f5 0%, #eeeeee 100%);
            padding: 32px;
            border-radius: 10px;
            margin-bottom: 35px;
            border: 1.5px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .customer-name {
            font-size: 34px;
            font-weight: 700;
            color: #c8102e;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }
        
        .customer-address {
            font-size: 16px;
            color: #666;
            font-weight: 400;
        }
        
        .progress-indicator {
            background: #f5f5f5;
            height: 4px;
            border-radius: 2px;
            margin: 30px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #c8102e 0%, #a00d24 100%);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo -->
        <div class="logo-container">
            <img src="illycaffe_logo_PRINT_CMYK_RED_80mm_JPG.jpg" alt="illycaff√® Logo">
        </div>
        
        <h1>Loaned Equipment Verification</h1>
        <p class="subtitle">Annual Asset Audit & Inventory Review</p>
        
        <!-- Account Number Search Section -->
        <div class="account-search">
            <div class="form-group">
                <label for="accountNumberInput" class="required">Account Number</label>
                <div style="display: flex; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <input type="text" id="accountNumberInput" placeholder="Enter your account number">
                    <button class="search-btn" onclick="loadAccountData()">Load Account</button>
                </div>
                <div id="accountError" class="error">Account not found. Please check the account number.</div>
                <div class="loading" id="loadingAccount">Loading account data</div>
            </div>
        </div>
        
        <!-- Main Form (Hidden until account is loaded) -->
        <div id="formContent">
            <form id="verificationForm">
                <!-- Customer Info Banner -->
                <div class="customer-banner">
                    <div class="customer-name" id="customerName">-</div>
                    <div class="customer-address" id="customerAddress">-</div>
                </div>
                
                <div class="intro-text">
                    <h3 style="color: #1976D2; margin-top: 0; margin-bottom: 15px; font-size: 18px;">üìã Step-by-Step Instructions</h3>
                    <p style="font-style: italic; color: #666; margin-bottom: 18px; font-size: 14px;">Estimated Time: 10-15 minutes, depending on the number of machines</p>
                    
                    <ol style="line-height: 2; padding-left: 20px; font-size: 14px;">
                        <li><strong>Review your equipment list:</strong> The form below displays all equipment we have on record for your location</li>
                        
                        <li><strong>Verify each item:</strong> For each piece of equipment listed:
                            <ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 40px;">
                                <li>Confirm whether it is currently at your location (Yes/No)</li>
                                <li>If present, indicate exact location within the establishment and proceed to Step 3</li>
                            </ul>
                        </li>
                        
                        <li><strong>Apply identification stickers:</strong>
                            <ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 40px;">
                                <li>Use the enclosed pre-numbered stickers</li>
                                <li>Apply ONE sticker to EACH piece of equipment</li>
                                <li><strong>Preferred placement:</strong> Near the manufacturer's serial number plate, if easily accessible</li>
                                <li><strong>Alternative placement:</strong> If the serial number plate is not accessible, place the sticker in a visible location that can be easily scanned by a service technician during routine maintenance calls</li>
                                <li><strong>Important:</strong> Avoid placing stickers where they may be exposed to excessive heat, moisture, or cleaning chemicals</li>
                            </ul>
                        </li>
                        
                        <li><strong>Record sticker codes:</strong> Enter each sticker's unique code (format: CYA######ILLY) into the form</li>
                        
                        <li><strong>Report additional equipment:</strong> If you have illycaff√® equipment not listed in the form, add it in the "Additional Equipment" section at the bottom</li>
                        
                        <li><strong>Provide contact information:</strong> Enter the name and contact details of the person we should reach if we need photos or additional information</li>
                        
                        <li><strong>Submit:</strong> Review and submit your completed form</li>
                    </ol>
                    
                    <div style="margin-top: 24px; padding: 20px; background: linear-gradient(135deg, #fff9e6 0%, #fff3d6 100%); border-left: 4px solid #ffa726; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <h4 style="color: #f57c00; margin: 0 0 12px 0; font-size: 15px; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 18px;">üí°</span> Troubleshooting Tips
                        </h4>
                        <p style="font-size: 13px; color: #555; margin-bottom: 12px; font-weight: 500;">If the Submit button doesn't respond, try these steps in order:</p>
                        <ol style="font-size: 13px; color: #555; padding-left: 22px; line-height: 1.9; margin: 0 0 12px 0;">
                            <li style="margin-bottom: 8px;"><strong>Check all required fields:</strong> Ensure you selected <strong>Yes or No for every asset</strong>, and filled in location/sticker codes for assets marked "Yes"</li>
                            <li style="margin-bottom: 8px;"><strong>Try Incognito/Private mode:</strong> 
                                <div style="margin-top: 4px; padding: 8px 12px; background-color: rgba(255,255,255,0.7); border-radius: 4px; font-size: 12px;">
                                    Open a new private window to disable browser extensions that might interfere:<br>
                                    ‚Ä¢ <strong>Chrome:</strong> Press Ctrl+Shift+N (Windows) or Cmd+Shift+N (Mac)<br>
                                    ‚Ä¢ <strong>Firefox:</strong> Press Ctrl+Shift+P (Windows) or Cmd+Shift+P (Mac)<br>
                                    ‚Ä¢ <strong>Safari:</strong> File menu ‚Üí New Private Window<br>
                                    ‚Ä¢ <strong>Edge:</strong> Press Ctrl+Shift+N (Windows) or Cmd+Shift+N (Mac)
                                </div>
                            </li>
                            <li style="margin-bottom: 8px;"><strong>Use a recommended browser:</strong> Chrome, Firefox, Safari, or Edge (latest versions work best)</li>
                            <li style="margin-bottom: 8px;"><strong>Check your internet connection:</strong> Ensure you have a stable connection to submit the form</li>
                        </ol>
                        <div style="padding: 12px; background-color: rgba(200,16,46,0.08); border-radius: 4px; border: 1px solid rgba(200,16,46,0.2);">
                            <p style="font-size: 13px; color: #333; margin: 0;">
                                <strong>Still experiencing issues?</strong> Please email <a href="mailto:CYA@illy.com" style="color: #c8102e; font-weight: bold; text-decoration: none; border-bottom: 1px solid #c8102e;">CYA@illy.com</a> with:
                            </p>
                            <ul style="font-size: 12px; color: #555; margin: 8px 0 0 20px; line-height: 1.6;">
                                <li>Your account number</li>
                                <li>Description of the issue</li>
                                <li>Which browser and device you're using</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <h2>Please verify each machine listed below:</h2>
                
                <!-- Assets will be dynamically inserted here -->
                <div id="assetsContainer"></div>
                
                <!-- Additional Equipment Section -->
                <h2>Additional Equipment Not Listed Above</h2>
                
                <div class="form-group">
                    <label>Do you have additional equipment not listed above?</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="hasAdditional" value="yes" onchange="toggleAdditionalEquipment()"> Yes
                        </label>
                        <label>
                            <input type="radio" name="hasAdditional" value="no" checked onchange="toggleAdditionalEquipment()"> No
                        </label>
                    </div>
                </div>
                
                <div id="additionalEquipmentSection" style="display: none;">
                    <div id="additionalMachinesContainer"></div>
                    <button type="button" class="add-machine-btn" onclick="addAdditionalMachine()">+ Add Another Machine</button>
                </div>
                
                <!-- Notes Section -->
                <h2>Notes or Comments (Optional)</h2>
                <div class="form-group">
                    <textarea id="notes" placeholder="Any additional information about the equipment"></textarea>
                </div>
                
                <!-- Thank You Section -->
                <div class="thank-you">
                    <h3 style="margin-top: 0; font-size: 18px;">Thank You</h3>
                    <p>Thank you for taking the time to complete this asset verification. Your cooperation helps us maintain accurate records and ensures compliance with our year-end audit requirements.</p>
                    <p style="margin-top: 15px;"><strong>If you have any questions or need assistance:</strong></p>
                    <ul style="margin-top: 8px; line-height: 1.8; padding-left: 20px;">
                        <li><strong>Primary Contact:</strong> Email <a href="mailto:CYA@illy.com" style="color: #c8102e; font-weight: bold;">CYA@illy.com</a> (Fixed Asset Manager)</li>
                        <li>Call Technical Support at <strong>1-800-USA-ILLY</strong> (Press Option 2)</li>
                        <li>Contact your Sales Representative</li>
                    </ul>
                </div>
                
                <!-- Contact Information -->
                <h2>Contact Information</h2>
                <p style="margin-bottom: 15px; color: #555;">In case we need to request pictures of the machines, who should we contact?</p>
                
                <div class="form-group">
                    <label for="contactName" class="required">Contact Name</label>
                    <input type="text" id="contactName" required>
                </div>
                
                <div class="form-group">
                    <label for="contactEmail" class="required">Email Address</label>
                    <input type="email" id="contactEmail" required>
                </div>
                
                <div class="form-group">
                    <label for="contactPhone">Phone Number (Optional)</label>
                    <input type="tel" id="contactPhone">
                </div>
                
                <!-- Form Completion -->
                <h2>Form Completion</h2>
                
                <div class="form-group">
                    <label for="completedBy" class="required">Full Name (Person completing this form)</label>
                    <input type="text" id="completedBy" required>
                </div>
                
                <div class="form-group">
                    <label for="completionDate" class="required">Date</label>
                    <input type="date" id="completionDate" required>
                </div>
                
                <p class="note">Required fields are marked with an asterisk (*)</p>
                
                <div class="loading" id="loadingMessage">Submitting form</div>
                
                <button type="submit" class="submit-btn" id="submitBtn">SUBMIT</button>
            </form>
        </div>
        
        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            <div class="logo-container" style="border-bottom: none; padding-bottom: 0; margin-bottom: 24px;">
                <img src="illycaffe_logo_PRINT_CMYK_RED_80mm_JPG.jpg" alt="illycaff√® Logo" style="max-width: 180px;">
            </div>
            <div class="success-checkmark"></div>
            <h2 style="font-size: 28px; border: none; padding-bottom: 0;">Form submitted successfully!</h2>
            <p style="font-size: 16px;">Your verification has been recorded.</p>
            <p style="margin-top: 15px; font-size: 15px;">Thank you for completing the asset verification form.</p>
            <button onclick="location.reload()" style="margin-top: 24px; background: linear-gradient(135deg, #c8102e 0%, #a00d24 100%);">Submit Another Form</button>
        </div>
        
        <!-- Error Message -->
        <div class="error-message" id="errorMessage">
            <h2 style="font-size: 26px;">Submission Error</h2>
            <p id="errorText" style="font-size: 15px;">There was an error submitting the form. Please try again.</p>
            <p style="margin-top: 15px; font-size: 14px;">If the problem persists, please contact <a href="mailto:CYA@illy.com" style="color: #c8102e; font-weight: bold;">CYA@illy.com</a></p>
            <button onclick="hideError()" style="margin-top: 24px; background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);">Try Again</button>
        </div>
    </div>

    <script>
        // Google Apps Script URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyXBABjyiuPJeymayI_FMwvHH6VcFLfl6yPTkyICiD2pXVZh7oRqTzFY7aAtyeyAPd7/exec';
        
        let currentAccountData = [];
        let additionalMachineCount = 0;

        // Set today's date on page load
        window.onload = function() {
            document.getElementById('completionDate').valueAsDate = new Date();
        };

        // Load account data from Google Apps Script
        async function loadAccountData() {
            const accountNumber = document.getElementById('accountNumberInput').value.trim();
            const errorDiv = document.getElementById('accountError');
            const loadingDiv = document.getElementById('loadingAccount');
            
            if (accountNumber === '') {
                errorDiv.textContent = 'Please enter an account number.';
                errorDiv.style.display = 'block';
                return;
            }
            
            // Show loading
            loadingDiv.style.display = 'block';
            errorDiv.style.display = 'none';
            document.getElementById('formContent').style.display = 'none';
            
            try {
                // Call Google Apps Script
                const response = await fetch(`${SCRIPT_URL}?accountNumber=${encodeURIComponent(accountNumber)}`);
                const result = await response.json();
                
                // Hide loading
                loadingDiv.style.display = 'none';
                
                if (!result.success) {
                    errorDiv.textContent = result.message || 'Account not found. Please check the account number.';
                    errorDiv.style.display = 'block';
                    return;
                }
                
                // Store account data
                currentAccountData = result.data;
                
                // Display form
                document.getElementById('formContent').style.display = 'block';
                
                // Set customer name and address
                const firstRecord = currentAccountData[0];
                document.getElementById('customerName').textContent = firstRecord.CustomerName || 'Unknown';
                
                const address = firstRecord.Address || '';
                const city = firstRecord.City || '';
                const state = firstRecord.State || '';
                const zip = firstRecord.Zip || '';
                const addressLine1 = address;
                const addressLine2 = `${city}, ${state} ${zip}`.trim();
                const fullAddress = addressLine1 + (addressLine2 ? '<br>' + addressLine2 : '');
                document.getElementById('customerAddress').innerHTML = fullAddress || 'Address not available';
                
                // Generate asset cards
                generateAssetCards();
                
                // Scroll to form
                document.getElementById('formContent').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                loadingDiv.style.display = 'none';
                errorDiv.textContent = 'Error loading account data: ' + error.message;
                errorDiv.style.display = 'block';
                console.error('Error:', error);
            }
        }

        function generateAssetCards() {
            const container = document.getElementById('assetsContainer');
            container.innerHTML = '';
            
            currentAccountData.forEach((asset, index) => {
                const assetCard = document.createElement('div');
                assetCard.className = 'asset-card';
                assetCard.innerHTML = `
                    <div class="asset-header">Asset #${index + 1}</div>
                    <div class="asset-info">
                        <strong>Equipment:</strong> ${asset.Description || 'N/A'}
                    </div>
                    <div class="asset-info">
                        <strong>Serial Number:</strong> ${asset.SerialNumber || 'N/A'}
                    </div>
                    <div class="form-group">
                        <label class="required">Is this Serial Number currently at your location?</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="asset_${index}_present" value="yes" onchange="toggleStickerField(${index}, true)" required> Yes
                            </label>
                            <label>
                                <input type="radio" name="asset_${index}_present" value="no" onchange="toggleStickerField(${index}, false)" required> No
                            </label>
                        </div>
                    </div>
                    <div id="stickerField_${index}" class="sticker-field">    
                    <div class="form-group">
                        <label class="required">Where is this equipment located within your establishment?<br><span style="font-size: 12px; font-weight: normal; color: #666;">(Please be as specific and precise as possible)</span></label>
                        <input type="text" id="location_${index}" placeholder="e.g., Banquets, Kitchen, Floor 2 Restaurant, Pantry, Caf√©, Ballroom, Back of House, Bar, Basement, In-Room Dining, Storage">
                    </div>
                        <div class="form-group">
                            <label class="required">Please apply a sticker to this machine and enter the sticker code below:</label>
                            <input type="text" id="sticker_${index}" placeholder="e.g., CYA102030ILLY" oninput="validateStickerCode(${index})">
                            <div class="sticker-hint">Format: CYA followed by 6 digits, then ILLY (e.g., CYA123456ILLY). Capitalize all letters!</div>
                            <div id="stickerError_${index}" class="validation-error">Invalid format. Code must be: CYA + 6 digits + ILLY (e.g., CYA123456ILLY)</div>
                        </div>
                    </div>
                `;
                container.appendChild(assetCard);
            });
        }

        function toggleStickerField(index, show) {
            const stickerField = document.getElementById(`stickerField_${index}`);
            const stickerInput = document.getElementById(`sticker_${index}`);
            const locationInput = document.getElementById(`location_${index}`);
            const stickerError = document.getElementById(`stickerError_${index}`);
            
            if (show) {
                stickerField.classList.add('show');
                stickerInput.required = true;
                locationInput.required = true;
            } else {
                stickerField.classList.remove('show');
                stickerInput.required = false;
                locationInput.required = false;
                stickerInput.value = '';
                locationInput.value = '';
                stickerInput.classList.remove('invalid');
                stickerError.classList.remove('show');
            }
        }

        function validateStickerCode(index) {
            const stickerInput = document.getElementById(`sticker_${index}`);
            const stickerError = document.getElementById(`stickerError_${index}`);
            const code = stickerInput.value.trim();
            
            const pattern = /^CYA\d{6}ILLY$/;
            
            if (code && !pattern.test(code)) {
                stickerInput.classList.add('invalid');
                stickerError.classList.add('show');
                return false;
            } else {
                stickerInput.classList.remove('invalid');
                stickerError.classList.remove('show');
                return true;
            }
        }

        function validateAdditionalStickerCode(id) {
            const stickerInput = document.getElementById(`addSticker_${id}`);
            const stickerError = document.getElementById(`addStickerError_${id}`);
            const code = stickerInput.value.trim();
            
            const pattern = /^CYA\d{6}ILLY$/;
            
            if (code && !pattern.test(code)) {
                stickerInput.classList.add('invalid');
                stickerError.classList.add('show');
                return false;
            } else {
                stickerInput.classList.remove('invalid');
                stickerError.classList.remove('show');
                return true;
            }
        }

        function toggleAdditionalEquipment() {
            const hasAdditional = document.querySelector('input[name="hasAdditional"]:checked').value;
            const section = document.getElementById('additionalEquipmentSection');
            
            if (hasAdditional === 'yes') {
                section.style.display = 'block';
                if (additionalMachineCount === 0) {
                    addAdditionalMachine();
                }
            } else {
                section.style.display = 'none';
            }
        }

        function addAdditionalMachine() {
            additionalMachineCount++;
            const container = document.getElementById('additionalMachinesContainer');
            
            const machineDiv = document.createElement('div');
            machineDiv.className = 'additional-machine';
            machineDiv.id = `additionalMachine_${additionalMachineCount}`;
            machineDiv.innerHTML = `
                <h3>Additional Machine #${additionalMachineCount}</h3>
                
                <div class="form-group">
                    <label class="required">Machine Type</label>
                    <select id="addType_${additionalMachineCount}" required>
                        <option value="">Select...</option>
                        <option value="Capsule Machine">Capsule Machine</option>
                        <option value="Cart">Cart</option>
                        <option value="Coffee & Tea Brewer">Coffee & Tea Brewer</option>
                        <option value="Coffee Brewer">Coffee Brewer</option>
                        <option value="Coffee Grinder">Coffee Grinder</option>
                        <option value="Cold Brew">Cold Brew</option>
                        <option value="Dispenser">Dispenser</option>
                        <option value="Espresso Grinder">Espresso Grinder</option>
                        <option value="Espresso Machine">Espresso Machine</option>
                        <option value="Granita Maker">Granita Maker</option>
                        <option value="Hot Water Dispenser">Hot Water Dispenser</option>
                        <option value="Iced Tea Brewer">Iced Tea Brewer</option>
                        <option value="Milk Cooler">Milk Cooler</option>
                        <option value="Specialty Brewer">Specialty Brewer</option>
                        <option value="Super Automatic">Super Automatic</option>
                        <option value="Vending Machine">Vending Machine</option>
                        <option value="Other Coffee Machines">Other Coffee Machines</option>
                    </select>
                </div>
<div class="form-group">
                    <label class="required">Make</label>
                    <select id="addMake_${additionalMachineCount}" onchange="toggleOtherMake(${additionalMachineCount})" required>
                        <option value="">Select...</option>
                        <option value="Fetco">Fetco</option>
                        <option value="Brood Refreshments">Brood Refreshments</option>
                        <option value="Bunn">Bunn</option>
                        <option value="Curtis">Curtis</option>
                        <option value="Casadio">Casadio</option>
                        <option value="Cimbali Group">Cimbali Group</option>
                        <option value="Compak">Compak</option>
                        <option value="Dammann">Dammann</option>
                        <option value="Eversys">Eversys</option>
                        <option value="Fas Vending">Fas Vending</option>
                        <option value="Ferla">Ferla</option>
                        <option value="HLF">HLF</option>
                        <option value="illy">illy</option>
                        <option value="La Marzocco">La Marzocco</option>
                        <option value="Jura">Jura</option>
                        <option value="Mazzer">Mazzer</option>
                        <option value="Nuova Simonelli">Nuova Simonelli</option>
                        <option value="Pasquini">Pasquini</option>
                        <option value="Slayer">Slayer</option>
                        <option value="SPM">SPM</option>
                        <option value="UNIC">UNIC</option>
                        <option value="Victoria Arduino">Victoria Arduino</option>
                        <option value="Vitifrigo">Vitifrigo</option>
                        <option value="Wittenborg">Wittenborg</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div id="otherMakeField_${additionalMachineCount}" class="conditional-field">
                    <label>If "Other," please specify:</label>
                    <input type="text" id="addMakeOther_${additionalMachineCount}">
                </div>
                
                <div class="form-group">
                    <label>Model</label>
                    <input type="text" id="addModel_${additionalMachineCount}" placeholder="e.g., K10 WBC, CBS-2131XTS, Aurelia II">
                </div>
                
                <div class="form-group">
                    <label class="required">Serial Number</label>
                    <input type="text" id="addSerial_${additionalMachineCount}" required>
                </div>
                
                <div class="form-group">
                    <label class="required">Where is this equipment located within your establishment?<br><span style="font-size: 12px; font-weight: normal; color: #666;">(Please be as specific and precise as possible)</span></label>
                    <input type="text" id="addLocation_${additionalMachineCount}" placeholder="e.g., Banquets Kitchen, Restaurant Floor 2, Pantry, Caf√©, Ballroom, Back of House, Bar, Basement, In-Room Dining" required>
                </div>
                
                <div class="form-group">
                    <label class="required">Sticker Code Applied</label>
                    <input type="text" id="addSticker_${additionalMachineCount}" placeholder="e.g., CYA102030ILLY" oninput="validateAdditionalStickerCode(${additionalMachineCount})" required>
                    <div class="sticker-hint">Format: CYA followed by 6 digits, then ILLY (e.g., CYA123456ILLY)</div>
                    <div id="addStickerError_${additionalMachineCount}" class="validation-error">Invalid format. Code must be: CYA + 6 digits + ILLY (e.g., CYA123456ILLY). Capitalize all letters!</div>
                </div>
                
                <button type="button" class="remove-machine-btn" onclick="removeAdditionalMachine(${additionalMachineCount})">Remove Machine</button>
            `;
            
            container.appendChild(machineDiv);
        }

        function removeAdditionalMachine(id) {
            const machine = document.getElementById(`additionalMachine_${id}`);
            machine.remove();
        }

        function toggleOtherMake(id) {
            const makeSelect = document.getElementById(`addMake_${id}`);
            const otherField = document.getElementById(`otherMakeField_${id}`);
            
            if (makeSelect.value === 'Other') {
                otherField.classList.add('show');
            } else {
                otherField.classList.remove('show');
                document.getElementById(`addMakeOther_${id}`).value = '';
            }
        }

        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('formContent').style.display = 'block';
        }

        // PRODUCTION Form submission
        document.getElementById('verificationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Step 1: Check if all assets have Yes/No selected
            let unansweredAssets = [];
            for (let index = 0; index < currentAccountData.length; index++) {
                const present = document.querySelector(`input[name="asset_${index}_present"]:checked`);
                if (!present) {
                    unansweredAssets.push(index + 1);
                }
            }
            
            if (unansweredAssets.length > 0) {
                alert(`Please select Yes or No for the following asset(s):\n\nAsset #${unansweredAssets.join(', Asset #')}\n\nYou must indicate whether each piece of equipment is currently at your location.`);
                return;
            }
            
            // Step 2: Validate assets marked as "Yes"
            for (let index = 0; index < currentAccountData.length; index++) {
                const asset = currentAccountData[index];
                const present = document.querySelector(`input[name="asset_${index}_present"]:checked`).value;
                
                if (present === 'yes') {
                    const stickerInput = document.getElementById(`sticker_${index}`);
                    const locationInput = document.getElementById(`location_${index}`);
                    const code = stickerInput ? stickerInput.value.trim() : '';
                    const location = locationInput ? locationInput.value.trim() : '';
                    
                    if (!location) {
                        alert(`Please specify the location for:\n\nAsset #${index + 1}: ${asset.Description}\n\nWe need to know where this equipment is located within your establishment.`);
                        locationInput.focus();
                        return;
                    }
                    
                    if (!code) {
                        alert(`Please enter the sticker code for:\n\nAsset #${index + 1}: ${asset.Description}\n\nAfter applying the sticker to this equipment, enter its unique code here.`);
                        stickerInput.focus();
                        return;
                    }
                    
                    if (!validateStickerCode(index)) {
                        alert(`Invalid sticker code format for:\n\nAsset #${index + 1}: ${asset.Description}\n\nThe code must follow this format: CYA + 6 digits + ILLY\nExample: CYA123456ILLY\n\nPlease check the sticker and re-enter the code.`);
                        stickerInput.focus();
                        return;
                    }
                }
            }
            
            // Step 3: Validate additional equipment if applicable
            const hasAdditional = document.querySelector('input[name="hasAdditional"]:checked').value;
            if (hasAdditional === 'yes') {
                for (let i = 1; i <= additionalMachineCount; i++) {
                    const machineDiv = document.getElementById(`additionalMachine_${i}`);
                    if (machineDiv) {
                        const type = document.getElementById(`addType_${i}`)?.value;
                        const make = document.getElementById(`addMake_${i}`)?.value;
                        const serial = document.getElementById(`addSerial_${i}`)?.value;
                        const location = document.getElementById(`addLocation_${i}`)?.value;
                        const sticker = document.getElementById(`addSticker_${i}`)?.value;
                        
                        if (!type || !make || !serial || !location || !sticker) {
                            alert(`Please complete all required fields for Additional Machine #${i}.\n\nRequired fields:\n‚Ä¢ Machine Type\n‚Ä¢ Make\n‚Ä¢ Serial Number\n‚Ä¢ Location\n‚Ä¢ Sticker Code`);
                            return;
                        }
                        
                        if (!validateAdditionalStickerCode(i)) {
                            alert(`Invalid sticker code format for Additional Machine #${i}.\n\nThe code must follow this format: CYA + 6 digits + ILLY\nExample: CYA123456ILLY`);
                            document.getElementById(`addSticker_${i}`).focus();
                            return;
                        }
                    }
                }
            }
            
            // Step 4: Validate contact information
            const contactName = document.getElementById('contactName').value.trim();
            const contactEmail = document.getElementById('contactEmail').value.trim();
            const completedBy = document.getElementById('completedBy').value.trim();
            const completionDate = document.getElementById('completionDate').value;
            
            if (!contactName || !contactEmail || !completedBy || !completionDate) {
                alert('Please fill in all required contact and completion fields:\n\n‚Ä¢ Contact Name\n‚Ä¢ Email Address\n‚Ä¢ Full Name (person completing form)\n‚Ä¢ Date');
                return;
            }
            
            // All validation passed - proceed with submission
            document.getElementById('loadingMessage').style.display = 'block';
            document.getElementById('submitBtn').disabled = true;
            
            // Collect form data
            const formData = {
                accountNumber: document.getElementById('accountNumberInput').value,
                customerName: document.getElementById('customerName').textContent,
                customerAddress: document.getElementById('customerAddress').textContent.replace(/<br>/g, ', '),
                assets: [],
                additionalMachines: [],
                notes: document.getElementById('notes').value,
                contactName: contactName,
                contactEmail: contactEmail,
                contactPhone: document.getElementById('contactPhone').value,
                completedBy: completedBy,
                completionDate: completionDate
            };
            
            // Collect asset data
            currentAccountData.forEach((asset, index) => {
                const present = document.querySelector(`input[name="asset_${index}_present"]:checked`).value;
                const sticker = present === 'yes' ? (document.getElementById(`sticker_${index}`)?.value || '') : '';
                const location = present === 'yes' ? (document.getElementById(`location_${index}`)?.value || '') : '';
                
                formData.assets.push({
                    description: asset.Description || '',
                    serialNumber: asset.SerialNumber || '',
                    present: present,
                    location: location,
                    stickerCode: sticker
                });
            });
            
            // Collect additional machines
            if (hasAdditional === 'yes') {
                for (let i = 1; i <= additionalMachineCount; i++) {
                    const machineDiv = document.getElementById(`additionalMachine_${i}`);
                    if (machineDiv) {
                        const type = document.getElementById(`addType_${i}`)?.value || '';
                        const make = document.getElementById(`addMake_${i}`)?.value || '';
                        const makeOther = document.getElementById(`addMakeOther_${i}`)?.value || '';
                        const model = document.getElementById(`addModel_${i}`)?.value || '';
                        const serial = document.getElementById(`addSerial_${i}`)?.value || '';
                        const location = document.getElementById(`addLocation_${i}`)?.value || '';
                        const sticker = document.getElementById(`addSticker_${i}`)?.value || '';
                        
                        formData.additionalMachines.push({
                            type: type,
                            make: make === 'Other' ? makeOther : make,
                            model: model,
                            serialNumber: serial,
                            location: location,
                            stickerCode: sticker
                        });
                    }
                }
            }
            
            // Send data using XMLHttpRequest
            const xhr = new XMLHttpRequest();
            xhr.open('POST', SCRIPT_URL, true);
            xhr.setRequestHeader('Content-Type', 'text/plain;charset=utf-8');
            xhr.timeout = 30000;
            
            xhr.onload = function() {
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('submitBtn').disabled = false;
                
                // Accept success on these status codes
                if (xhr.status === 200 || xhr.status === 302 || xhr.status === 0) {
                    try {
                        const result = JSON.parse(xhr.responseText);
                        if (result.success !== false) {
                            showSuccess();
                        } else {
                            showError('The server reported an error: ' + (result.message || 'Unknown error'));
                        }
                    } catch (e) {
                        // If can't parse JSON but got good status, assume success
                        showSuccess();
                    }
                } else {
                    showError('Server error (Status: ' + xhr.status + '). Please try again or contact support.');
                }
            };
            
            xhr.onerror = function() {
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('submitBtn').disabled = false;
                showError('Network error. Please check your internet connection and try again.');
            };
            
            xhr.ontimeout = function() {
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('submitBtn').disabled = false;
                showError('Request timed out. Please try again.');
            };
            
            // Send the request
            xhr.send(JSON.stringify(formData));
        });
        
        function showSuccess() {
            document.getElementById('formContent').style.display = 'none';
            document.getElementById('successMessage').style.display = 'block';
            document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth' });
        }
        
        function showError(message) {
            document.getElementById('formContent').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
